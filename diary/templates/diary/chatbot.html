{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Chatbot</title>
<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    background-color: #fffaf7;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    position: relative;
  }

  /* ğŸ§¸ å³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚¿ã‚¤ãƒˆãƒ« */
  .username-title {
    position: absolute;
    top: 14px;
    right: 16px;
    font-size: 20px;
    font-weight: bold;
    color: #ff91a4;
    text-shadow: 1px 1px #ffe6ea;
    letter-spacing: 1px;
    z-index: 101;
  }

  /* ğŸ  ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ï¼ˆå·¦ä¸Šå›ºå®šï¼‰ */
  .home-btn {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 100;
  }

  .home-btn img {
    width: 130px;
    height: auto;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .home-btn img:hover {
    transform: scale(1.05);
  }

  /* ä¸Šéƒ¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ */
  header {
    background-color: #ffd6e7;
    color: #6a4a32;
    padding: 16px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    letter-spacing: 1px;
  }

  /* ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ */
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 16px;
    overflow-y: auto;
    background-size: cover;
    background-position: center;
  }

  /* å¹ãå‡ºã— */
  .message {
    max-width: 75%;
    padding: 10px 14px;
    margin: 8px 0;
    border-radius: 14px;
    font-size: 15px;
    line-height: 1.6;
  }

  .user {
    align-self: flex-end;
    background-color: #ffe1ed;
    color: #333;
    border-top-right-radius: 0;
  }

  .bot {
    align-self: flex-start;
    background-color: #fff;
    border: 1.5px solid #ffb6c1;
    color: #444;
    border-top-left-radius: 0;
  }

  /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
  .input-area {
    display: flex;
    border-top: 2px solid #f3c8d4;
    padding: 10px;
    background-color: #fff;
  }

  .input-area input {
    flex: 1;
    padding: 12px;
    border: 2px solid #ffb6c1;
    border-radius: 20px;
    font-size: 16px;
    outline: none;
  }

  .input-area button {
    background-color: #ff91a4;
    color: #fff;
    border: none;
    border-radius: 20px;
    padding: 10px 18px;
    margin-left: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
  }

  .input-area button:hover {
    background-color: #ff6385;
  }

  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */
  ::-webkit-scrollbar {
    display: none;
  }
</style>
</head>
<body>

  <!-- ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚¿ã‚¤ãƒˆãƒ« -->
  <div class="username-title">
    {{ profile.username }} Diary
  </div>

  <!-- ğŸ  ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
  <div class="home-btn">
    <a href="{% url 'diary:mypage' %}">
      <img src="{% static 'images/home_button.png' %}" alt="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹">
    </a>
  </div>

  <header>ğŸ¤– Music Chatbot ğŸ¶</header>

  <div class="chat-container" id="chat-container">
    <div class="message bot">
      ã“ã‚“ã«ã¡ã¯ï¼éŸ³æ¥½ã®è©±ã‚’ã—ã‚ˆã†ğŸµ<br>
      å¥½ããªã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚„æ›²ã®æ°—åˆ†ã‚’æ•™ãˆã¦ã­ã€‚
    </div>
  </div>

  <div class="input-area">
    <input type="text" id="user-input" placeholder="éŸ³æ¥½ã«ã¤ã„ã¦è©±ã—ã‹ã‘ã¦ã¿ã‚ˆã†â€¦" />
    <button onclick="sendMessage()">é€ä¿¡</button>
  </div>

  <script>
    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");

    function addMessage(text, sender) {
      const msg = document.createElement("div");
      msg.classList.add("message", sender);
      msg.innerHTML = text;
      chatContainer.appendChild(msg);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage(text, "user");
      userInput.value = "";

      const loading = document.createElement("div");
      loading.classList.add("message", "bot");
      loading.innerText = "ğŸµ è€ƒãˆä¸­â€¦";
      chatContainer.appendChild(loading);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      const response = await fetch("{% url 'diary:chatbot' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ message: text })
      });

      const data = await response.json();
      loading.remove();
      addMessage(data.reply, "bot");
    }
  </script>
</body>
</html>


